piVersion: apps/v1
kind: Deployment
metadata:
  name: neural-serch-stage
  namespace: neural-search-prod
  labels:
    app: neural-serch
    ref: dev
spec:
  replicas: 3
  selector:
    matchLabels:
      app: neural-serch
      ref: dev
  template:
    metadata:
      labels:
        app: neural-serch
        ref: dev
    spec:
      imagePullSecrets:
        - name: gcp_hub_secret 
      containers:
      - name: web
        image: ns-thumbnails:v0.0.1
        imagePullPolicy: Always
        env:
        - name: FLASK_ENV 
          value: "development"
        - name: FLASK_APP
          value: "search"
          #valueFrom:
          #  secretKeyRef:
          #    name: postgres-credentials
          #    key: password

        ports:
          - containerPort: 5000
        volumeMounts:
          - name: images-volume-mount
            mountPath: /home/ai-search/web/instances
      volumes:
        - name: embeddings-volume-mount
          persistentVolumeClsaim:
            claimName: embeddings-pvc
